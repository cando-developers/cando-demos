(COMMON-LISP:LOAD "source-dir:extensions;cando;src;lisp;start-cando.lisp")
(QUICKLISP-CLIENT:QUICKLOAD :FEP)
(COMMON-LISP:IN-PACKAGE :CANDO-USER)
(LEAP:SETUP-AMBER-PATHS)
(LEAP:SOURCE "leaprc.water.tip3p")
(LEAP:LOAD-OFF "solvents.lib")
(LEAP:LOAD-OFF "atomic_ions.lib")
(LEAP:LOAD-ATOM-TYPE-RULES "ATOMTYPE_GFF.DEF")
(LEAP:SOURCE "leaprc.ff14SB.redq")
(LEAP:SOURCE "leaprc.gaff")
(COMMON-LISP:DEFPARAMETER FEP::*FEPS* (FEP:LOAD-FEPS "postcharge/feps.cando"))
(COMMON-LISP:DEFPARAMETER FEP::*RECEPTOR*
  (COMMON-LISP:FIRST (FEP:RECEPTORS FEP::*FEPS*)))
(COMMON-LISP:DEFPARAMETER FEP::*SIDE-NAME* :COMPLEX)
(COMMON-LISP:DEFPARAMETER FEP::*MORPH*
  (FEP::FIND-MORPH-WITH-NAME "AA-AB" FEP::*FEPS*))
(COMMON-LISP:DEFPARAMETER FEP::*SOURCE* (FEP:SOURCE FEP::*MORPH*))
(COMMON-LISP:DEFPARAMETER FEP::*TARGET* (FEP:TARGET FEP::*MORPH*))
(FEP:AVERAGE-CORE-ATOM-POSITIONS FEP::*SOURCE* FEP::*TARGET*)
(COMMON-LISP:DEFPARAMETER FEP::*LIGANDS*
  (CANDO:COMBINE (FEP:MOLECULE FEP::*SOURCE*) (FEP:MOLECULE FEP::*TARGET*)))
(COMMON-LISP:FORMAT COMMON-LISP:T "*side-name* --> ~a~%" FEP::*SIDE-NAME*)
(COMMON-LISP:COND
 ((COMMON-LISP:EQ FEP::*SIDE-NAME* :LIGAND)
  (COMMON-LISP:FORMAT COMMON-LISP:T "Creating system by combining ligands~%")
  (COMMON-LISP:DEFPARAMETER FEP::*SYSTEM* (CHEM:MATTER-COPY FEP::*LIGANDS*)))
 ((COMMON-LISP:EQ FEP::*SIDE-NAME* :COMPLEX)
  (COMMON-LISP:FORMAT COMMON-LISP:T
                      "Creating system by combining ligands and receptor~%")
  (COMMON-LISP:DEFPARAMETER FEP::*SYSTEM*
    (CANDO:COMBINE (CHEM:MATTER-COPY FEP::*LIGANDS*)
                   (CHEM:MATTER-COPY FEP::*RECEPTOR*))))
 (COMMON-LISP:T
  (COMMON-LISP:ERROR
   "Unknown *side-name* ~s - must be one of :ligand or :complex"
   FEP::*SIDE-NAME*)))
(LEAP:SOLVATE-BOX FEP::*SYSTEM*
                  (LEAP.CORE:LOOKUP-VARIABLE (FEP::SOLVENT-BOX FEP::*FEPS*))
                  (FEP::SOLVENT-BUFFER FEP::*FEPS*)
                  (FEP::SOLVENT-CLOSENESS FEP::*FEPS*))
(LEAP.ADD-IONS:ADD-IONS FEP::*SYSTEM* :|Cl-| 0)
(CANDO:SAVE-MOL2 FEP::*SYSTEM* (COMMON-LISP:ENSURE-DIRECTORIES-EXIST "AA-AB/complex/complex-vdw-bonded.mol2"))
(COMMON-LISP:ENSURE-DIRECTORIES-EXIST (COMMON-LISP:PATHNAME "AA-AB/complex/complex-vdw-bonded.parm7"))
(COMMON-LISP:ENSURE-DIRECTORIES-EXIST (COMMON-LISP:PATHNAME "AA-AB/complex/complex-vdw-bonded.rst7"))
(LEAP.TOPOLOGY:SAVE-AMBER-PARM-FORMAT FEP::*SYSTEM*
                                      "AA-AB/complex/complex-vdw-bonded.parm7"
                                      "AA-AB/complex/complex-vdw-bonded.rst7")
(CORE:EXIT)
